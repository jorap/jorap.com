<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>OAuth Test</title>
</head>
<body>
    <h1>OAuth Test Page</h1>
    
    <h2>URL Info:</h2>
    <p><strong>Full URL:</strong> <span id="full-url"></span></p>
    <p><strong>Search params:</strong> <span id="search-params"></span></p>
    <p><strong>Code:</strong> <span id="code-value"></span></p>
    
    <h2>Test Results:</h2>
    <div id="results"></div>
    
    <h2>Raw Response:</h2>
    <pre id="raw-response"></pre>
    
    <script>
        // Show URL info
        document.getElementById('full-url').textContent = window.location.href;
        document.getElementById('search-params').textContent = window.location.search;
        
        // Get code
        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');
        document.getElementById('code-value').textContent = code || 'NOT FOUND';
        
        if (code) {
            document.getElementById('results').innerHTML = '<p>üîÑ Testing /oauth endpoint...</p>';
            
            // Test with very simple fetch
            fetch('/oauth', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ code: code })
            })
            .then(response => {
                document.getElementById('results').innerHTML = 
                    '<p>üì° Response Status: ' + response.status + '</p>' +
                    '<p>üì° Response OK: ' + response.ok + '</p>';
                return response.text();
            })
            .then(text => {
                document.getElementById('raw-response').textContent = text;
                
                try {
                    const data = JSON.parse(text);
                    if (data.token) {
                        document.getElementById('results').innerHTML += 
                            '<p>‚úÖ SUCCESS! Token received</p>' +
                            '<p>üîë Token starts with: ' + data.token.substring(0, 10) + '...</p>';
                    } else if (data.error) {
                        document.getElementById('results').innerHTML += 
                            '<p>‚ùå ERROR: ' + data.error + '</p>';
                    }
                } catch (e) {
                    document.getElementById('results').innerHTML += 
                        '<p>‚ùå JSON Parse Error: ' + e.message + '</p>';
                }
            })
            .catch(error => {
                document.getElementById('results').innerHTML += 
                    '<p>‚ùå Fetch Error: ' + error.message + '</p>';
                document.getElementById('raw-response').textContent = 'Fetch failed: ' + error.message;
            });
        } else {
            document.getElementById('results').innerHTML = '<p>‚ùå No authorization code found in URL</p>';
        }
    </script>
</body>
</html> 